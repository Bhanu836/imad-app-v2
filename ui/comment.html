<!doctype html>
<html>
    <head>
        <link href="/ui/style.css" rel="stylesheet" />
    </head>
    <body>
        <div class="container">
            <div class="center">
                
            </div>
            <h3>About Me</h3>
            <div>
                Hi. <br/>
                I work at Hasura
            </div>
            <hr/>
            <div id="login_area">
                <center>Loading login status...</center>
                  <div>
            <span> log in</span>
            <input type="text" id="username" placeholder="username" />
             <input type="password" id="password" placeholder="password" />
             <button type="submit"  id="submit_btn" > Login </button>
             <span> or register first</span>
             <button type="submit"  id="register_btn">register </button>
        </div>
        <div id="mess2" ></div>
            </div>
            <hr/>
            <h3>My Articles</h3>
            <div id="articles">
                <div>
            <span> article </span>
            <input type="text" id="title" placeholder="title" />
             <input type="text" id="heading" placeholder="heading" />
             <input type="text" id="content" placeholder="content" />
             <button type="submit"  id="article_btn" > submit </button></div>
                <center>Loading articles...</center>
            </div>
           
        
        <div id="spaceq">TO LOAD ARTICLES FOR DISCUSSION <button id="articleload_btn" >Click here</button></div>
        
            <div class="footer">
            </div>
        </div>
        <script type="text/javascript" src="/ui/main.js">
        </script>
        
        <script>
        var articleloadbtn = document.getElementById('articleload_btn');
        articleloadbtn.onclick = function(){
          loadLogin();  
        };
            
var subarticle = document.getElementById('article_btn');
subarticle.onclick = function(){
   
     var request = new XMLHttpRequest();
     
    
    
     request.onreadystatechange = function(){
                 
         if(request.status === 200){
             alert("submitted");
             
             loadLogin();
             
         }
         
          else if(request.readystate === XMLHttpRequest.DONE && request.status === 500)
         {
             alert("something went wrong");
         
         }
     
        
         
     };
      var title = document.getElementById('title').value;
     var content = document.getElementById('content').value;
     var heading = document.getElementById('heading').value;
     
   request.open('POST', 'http://bhanu836.imad.hasura-app.io/articledata',true);
     request.setRequestHeader('Content-Type','application/json');
request.send(JSON.stringify({title:title , heading:heading ,content:content}));
  
   function loadLogin () {
    // Check if the user is already logged in
    var request = new XMLHttpRequest();
    request.onreadystatechange = function () {
        
            if (request.status === 200) {
                loadarticle();
            }
        else if(request.status !== 200 ){
            res.send("login first");
        }
    };

   
    request.open('GET', '/check-login', true);
    request.send(null);


    
};

function loadarticle(){
             var request = new XMLHttpRequest();
    request.onreadystatechange = function () {
      
            var spaceq = document.getElementById('articlespace');
            if (request.status === 200) {
                var articleContent = '';
                var articleData = JSON.parse(this.responseText);
                console.log('articlespaceq')
                for (var i=0; i< articleData.length; i++)
                {
                articleContent += `<div class="article"><ul><li>
                            ${articleData[i].id} - ${articleData[i].title} </li> </ul>
                             </div>`;
                        }
                    spaceq.innerHTML = articleContent; 
                     }else if (request.status !== 200 && request.readyState === XMLHttpRequest.DONE) {
                spaceq.innerHTML = 'Oops! Could not load comments!';
            }
        
    };
    
    request.open('GET', '/get-article', true);
    request.send(null);
};
        </script>
    </body>
</html>
